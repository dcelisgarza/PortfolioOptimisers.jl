<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example 1: Simple MeanRisk optimisation · PortfolioOptimisers.jl</title><meta name="title" content="Example 1: Simple MeanRisk optimisation · PortfolioOptimisers.jl"/><meta property="og:title" content="Example 1: Simple MeanRisk optimisation · PortfolioOptimisers.jl"/><meta property="twitter:title" content="Example 1: Simple MeanRisk optimisation · PortfolioOptimisers.jl"/><meta name="description" content="Documentation for PortfolioOptimisers.jl."/><meta property="og:description" content="Documentation for PortfolioOptimisers.jl."/><meta property="twitter:description" content="Documentation for PortfolioOptimisers.jl."/><meta property="og:url" content="https://dcelisgarza.github.io/PortfolioOptimisers.jl/examples/1-Getting-Started/"/><meta property="twitter:url" content="https://dcelisgarza.github.io/PortfolioOptimisers.jl/examples/1-Getting-Started/"/><link rel="canonical" href="https://dcelisgarza.github.io/PortfolioOptimisers.jl/examples/1-Getting-Started/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="PortfolioOptimisers.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PortfolioOptimisers.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">PortfolioOptimisers</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Example 1: Simple <code>MeanRisk</code> optimisation</a><ul class="internal"><li><a class="tocitem" href="#1.-Load-the-data"><span>1. Load the data</span></a></li><li><a class="tocitem" href="#2.-MeanRisk-optimisation"><span>2. MeanRisk optimisation</span></a></li><li><a class="tocitem" href="#3.-Finite-allocation"><span>3. Finite allocation</span></a></li></ul></li><li><a class="tocitem" href="../2-Mean-Risk-Objectives/">Example 2: <code>MeanRisk</code> objectives</a></li><li><a class="tocitem" href="../3-Efficient-Frontier/">Example 3: Efficient frontier</a></li><li><a class="tocitem" href="../4-Pareto-Surface/">Example 4: Pareto surface</a></li><li><a class="tocitem" href="../5-Budget-Constraints/">Example 5: Budget constraints</a></li></ul></li><li><a class="tocitem" href="../../090-contributing/">Contributing guidelines</a></li><li><a class="tocitem" href="../../091-developer/">Developer documentation</a></li><li><a class="tocitem" href="../../092-reference/">Reference</a></li><li><span class="tocitem">API</span><ul><li><a class="tocitem" href="../../001-Base/">Base</a></li><li><a class="tocitem" href="../../002-Tools/">Tools</a></li><li><a class="tocitem" href="../../003-PosdefMatrix/">PosdefMatrix</a></li><li><a class="tocitem" href="../../004-Denoise/">Denoise</a></li><li><a class="tocitem" href="../../005-Detone/">Detone</a></li><li><a class="tocitem" href="../../006-MatrixProcessing/">Matrix Processing</a></li><li><input class="collapse-toggle" id="menuitem-6-7" type="checkbox"/><label class="tocitem" for="menuitem-6-7"><span class="docs-label">Moments</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../007-01-Moments/">Base Moments</a></li><li><a class="tocitem" href="../../007-02-Moments/">Mean</a></li><li><a class="tocitem" href="../../007-03-Moments/">Covariance</a></li><li><a class="tocitem" href="../../007-04-Moments/">Variance and Standard Deviation</a></li><li><a class="tocitem" href="../../007-05-Moments/">Gerber Covariance</a></li><li><a class="tocitem" href="../../007-06-Moments/">Smyth-Broby Covariance</a></li><li><a class="tocitem" href="../../007-07-Moments/">Distance Covariance</a></li><li><a class="tocitem" href="../../007-08-Moments/">Lower Tail Dependence Covariance</a></li><li><a class="tocitem" href="../../007-09-Moments/">Rank Covariances</a></li><li><a class="tocitem" href="../../007-10-Moments/">Histogram</a></li><li><a class="tocitem" href="../../007-11-Moments/">Mutual Information Covariance</a></li><li><a class="tocitem" href="../../007-12-Moments/">PortfolioOptimisersCovariance</a></li><li><a class="tocitem" href="../../007-13-Moments/">Shrunk Expected Returns</a></li><li><a class="tocitem" href="../../007-14-Moments/">Equilibrium expected returns</a></li><li><a class="tocitem" href="../../007-15-Moments/">Excess expected returns</a></li><li><a class="tocitem" href="../../007-16-Moments/">Coskewness</a></li><li><a class="tocitem" href="../../007-17-Moments/">Cokurtosis</a></li><li><a class="tocitem" href="../../007-18-Moments/">Regression</a></li><li><a class="tocitem" href="../../007-19-Moments/">Stepwise Regression</a></li><li><a class="tocitem" href="../../007-20-Moments/">Dimensional Reduction Regression</a></li><li><a class="tocitem" href="../../007-21-Moments/">Implied Volatility</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-8" type="checkbox"/><label class="tocitem" for="menuitem-6-8"><span class="docs-label">Distance</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../008-1-Distance/">Base Distance</a></li><li><a class="tocitem" href="../../008-2-Distance/">Distance</a></li><li><a class="tocitem" href="../../008-3-Distance/">Distances of Distances</a></li><li><a class="tocitem" href="../../008-4-Distance/">General Distance</a></li><li><a class="tocitem" href="../../008-5-Distance/">General Distance of Distances</a></li></ul></li><li><a class="tocitem" href="../../009-JuMPModelOptimisation/">JuMP Model Optimisation</a></li><li><a class="tocitem" href="../../010-OWA/">Ordered Weights Array</a></li><li><input class="collapse-toggle" id="menuitem-6-11" type="checkbox"/><label class="tocitem" for="menuitem-6-11"><span class="docs-label">Phylogeny</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../011-1-Base-Phylogeny/">Base Phylogeny</a></li><li><a class="tocitem" href="../../011-2-Clustering/">Clustering</a></li><li><a class="tocitem" href="../../011-3-Hierarchical/">Hierarchical</a></li><li><a class="tocitem" href="../../011-4-DBTH/">Direct Bubble Hierarchy Tree</a></li><li><a class="tocitem" href="../../011-5-Phylogeny/">Phylogeny</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Example 1: Simple <code>MeanRisk</code> optimisation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example 1: Simple <code>MeanRisk</code> optimisation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/dcelisgarza/PortfolioOptimisers.jl/blob/main/examples/1-Getting-Started.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>The source files for all examples can be found in <a href="https://github.com/dcelisgarza/PortfolioOptimiser.jl/tree/main/examples/">/examples</a>.</p><h1 id="Example-1:-Simple-MeanRisk-optimisation"><a class="docs-heading-anchor" href="#Example-1:-Simple-MeanRisk-optimisation">Example 1: Simple <code>MeanRisk</code> optimisation</a><a id="Example-1:-Simple-MeanRisk-optimisation-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-Simple-MeanRisk-optimisation" title="Permalink"></a></h1><p>Here we show a simple example of how to use <code>PortfolioOptimisers</code>. We will perform the classic Markowitz optimisation.</p><pre><code class="language-julia hljs">using PortfolioOptimisers</code></pre><p>PrettyTables is used to format the example output.</p><pre><code class="language-julia hljs">using PrettyTables

# Format for pretty tables.
tsfmt = (v, i, j) -&gt; begin
    if j == 1
        return Date(v)
    else
        return v
    end
end;
resfmt = (v, i, j) -&gt; begin
    if j == 1
        return v
    else
        return isa(v, Number) ? &quot;$(round(v*100, digits=3)) %&quot; : v
    end
end;
mipresfmt = (v, i, j) -&gt; begin
    if j ∈ (1, 2, 3)
        return v
    else
        return isa(v, Number) ? &quot;$(round(v*100, digits=3)) %&quot; : v
    end
end;</code></pre><h2 id="1.-Load-the-data"><a class="docs-heading-anchor" href="#1.-Load-the-data">1. Load the data</a><a id="1.-Load-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#1.-Load-the-data" title="Permalink"></a></h2><p>Import the S&amp;P500 data from a compressed <code>.csv</code> file. We will only use the last 253 observations.</p><pre><code class="language-julia hljs">using CSV, TimeSeries, DataFrames

X = TimeArray(CSV.File(joinpath(@__DIR__, &quot;SP500.csv.gz&quot;)); timestamp = :Date)[(end - 252):end]
pretty_table(X[(end - 5):end]; formatters = tsfmt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│  timestamp │    AAPL │     AMD │     BAC │     BBY │     CVX │      GE │      HD │     JNJ │     JPM │      KO │     LLY │     MRK │    MSFT │     PEP │     PFE │      PG │     RRC │     UNH │     WMT │     XOM │
│ Dates.Date │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │ Float64 │
├────────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ 2022-12-20 │ 131.916 │   65.05 │  31.729 │  77.371 │ 169.497 │  62.604 │ 310.342 │ 173.109 │ 127.844 │  61.841 │  357.55 │ 108.229 │  240.67 │ 178.765 │  49.754 │ 147.661 │   25.65 │ 516.245 │ 142.919 │ 104.964 │
│ 2022-12-21 │ 135.057 │   67.68 │  32.212 │  78.729 │  171.49 │   64.67 │ 314.798 │  175.09 │ 129.282 │  62.836 │ 365.872 │ 109.611 │ 243.287 │ 180.017 │  50.084 │ 149.015 │  26.574 │ 523.519 │  144.04 │ 106.312 │
│ 2022-12-22 │ 131.846 │   63.86 │  31.927 │  78.563 │ 168.918 │  63.727 │ 311.604 │  174.45 │ 127.814 │  62.383 │ 363.187 │ 109.739 │ 237.077 │ 178.627 │  50.065 │ 149.359 │  25.232 │ 523.072 │ 142.354 │ 104.168 │
│ 2022-12-23 │ 131.477 │   64.52 │  32.005 │  79.432 │  174.14 │  63.742 │ 314.177 │ 174.893 │ 128.421 │  62.855 │ 365.762 │  110.35 │ 237.614 │ 179.781 │  50.249 │ 149.781 │  26.226 │  527.26 │ 142.641 │ 106.922 │
│ 2022-12-27 │ 129.652 │   63.27 │  32.065 │   79.93 │ 176.329 │  64.561 │ 314.985 │ 174.844 │ 128.871 │   63.24 │  362.76 │ 110.607 │ 235.852 │  180.58 │   49.57 │ 151.086 │  26.375 │ 527.935 │ 142.681 │ 108.408 │
│ 2022-12-28 │ 125.674 │   62.57 │  32.301 │  78.279 │ 173.728 │  63.883 │  311.22 │ 174.085 │ 129.575 │  62.609 │ 363.098 │ 109.581 │ 233.434 │ 179.278 │   49.25 │ 149.133 │  24.497 │ 524.422 │ 140.181 │ 106.627 │
└────────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘</code></pre><p>First we must compute the returns from the prices. The <code>ReturnsResult</code> struct stores the asset names in <code>nx</code>, asset returns in <code>X</code>, and timestamps in <code>ts</code>. The other fields are used in other applications which we will not be showcasing here.</p><pre><code class="language-julia hljs">rd = prices_to_returns(X)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ReturnsResult
    nx | 20-element Vector{String}
     X | 252×20 Matrix{Float64}
    nf | nothing
     F | nothing
    ts | 252-element Vector{Dates.Date}
    iv | nothing
  ivpa | nothing
</code></pre><h2 id="2.-MeanRisk-optimisation"><a class="docs-heading-anchor" href="#2.-MeanRisk-optimisation">2. MeanRisk optimisation</a><a id="2.-MeanRisk-optimisation-1"></a><a class="docs-heading-anchor-permalink" href="#2.-MeanRisk-optimisation" title="Permalink"></a></h2><h3 id="2.1-Creating-a-solver-instance"><a class="docs-heading-anchor" href="#2.1-Creating-a-solver-instance">2.1 Creating a solver instance</a><a id="2.1-Creating-a-solver-instance-1"></a><a class="docs-heading-anchor-permalink" href="#2.1-Creating-a-solver-instance" title="Permalink"></a></h3><p>All optimisations require some prior statistics to be computed. This can either be done before the optimisation function, or within it. For certain optimisations, precomputing the prior is more efficient, but it makes no difference here so we&#39;ll do it within the optimisation.</p><p>The <code>MeanRisk</code> estimator defines a mean-risk optimisation problem. It is a <code>JuMPOptimisationEstimator</code>, which means it requires a <code>JuMP</code>-compatible optimiser, which in this case will be <code>Clarabel</code>.</p><pre><code class="language-julia hljs">using Clarabel</code></pre><p>We have to define a <code>Solver</code> object, which contains the optimiser we wish to use, an optional name for logging purposes, optional solver settings, and optional kwargs for <a href="https://jump.dev/JuMP.jl/stable/api/JuMP/#assert_is_solved_and_feasible"><code>JuMP.assert_is_solved_and_feasible</code></a>.</p><p>Given the vast range of optimisation options and types, it is often useful to try different solver and settings combinations. To this aim, it is also possible to provide a vector of <code>Solver</code> objects, which is iterated over until one succeeds or all fail. The classic Markowitz optimisation is rather simple, so we will use a single solver instance.</p><pre><code class="language-julia hljs">slv = Solver(; name = :clarabel1, solver = Clarabel.Optimizer,
             settings = Dict(&quot;verbose&quot; =&gt; false),
             check_sol = (; allow_local = true, allow_almost = true))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Solver
         name | Symbol: :clarabel1
       solver | UnionAll: Clarabel.MOIwrapper.Optimizer
     settings | Dict{String, Bool}: Dict{String, Bool}(&quot;verbose&quot; =&gt; 0)
    check_sol | @NamedTuple{allow_local::Bool, allow_almost::Bool}: (allow_local = true, allow_almost = true)
  add_bridges | Bool: true
</code></pre><h3 id="2.2-Defining-the-optimisation-estimator"><a class="docs-heading-anchor" href="#2.2-Defining-the-optimisation-estimator">2.2 Defining the optimisation estimator</a><a id="2.2-Defining-the-optimisation-estimator-1"></a><a class="docs-heading-anchor-permalink" href="#2.2-Defining-the-optimisation-estimator" title="Permalink"></a></h3><p><code>PortfolioOptimisers</code> is designed to heavily leverage composition. The first hint of this design ethos in the examples comes in the form of <code>JuMPOptimiser</code>, which is the structure defining the optimiser parameters used in all <code>JuMPOptimisationEstimator</code>s.</p><p>Lets create a <code>MeanRisk</code> estimator. As you can see from the output, <code>JuMPOptimiser</code> and <code>MeanRisk</code> contain myriad properties that we will not showcase in this example.</p><pre><code class="language-julia hljs">mr = MeanRisk(; opt = JuMPOptimiser(; slv = slv))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MeanRisk
       opt | JuMPOptimiser
           |       pe | EmpiricalPrior
           |          |        ce | PortfolioOptimisersCovariance
           |          |           |   ce | Covariance
           |          |           |      |    me | SimpleExpectedReturns
           |          |           |      |       |   w | nothing
           |          |           |      |    ce | GeneralWeightedCovariance
           |          |           |      |       |   ce | SimpleCovariance: SimpleCovariance(true)
           |          |           |      |       |    w | nothing
           |          |           |      |   alg | Full()
           |          |           |   mp | DefaultMatrixProcessing
           |          |           |      |       pdm | Posdef
           |          |           |      |           |   alg | UnionAll: NearestCorrelationMatrix.Newton
           |          |           |      |   denoise | nothing
           |          |           |      |    detone | nothing
           |          |           |      |       alg | nothing
           |          |        me | SimpleExpectedReturns
           |          |           |   w | nothing
           |          |   horizon | nothing
           |      slv | Solver
           |          |          name | Symbol: :clarabel1
           |          |        solver | UnionAll: Clarabel.MOIwrapper.Optimizer
           |          |      settings | Dict{String, Bool}: Dict{String, Bool}(&quot;verbose&quot; =&gt; 0)
           |          |     check_sol | @NamedTuple{allow_local::Bool, allow_almost::Bool}: (allow_local = true, allow_almost = true)
           |          |   add_bridges | Bool: true
           |       wb | WeightBounds
           |          |   lb | Float64: 0.0
           |          |   ub | Float64: 1.0
           |      bgt | Float64: 1.0
           |     sbgt | nothing
           |       lt | nothing
           |       st | nothing
           |      lcs | nothing
           |      lcm | nothing
           |     cent | nothing
           |    gcard | nothing
           |   sgcard | nothing
           |     smtx | nothing
           |    sgmtx | nothing
           |      slt | nothing
           |      sst | nothing
           |     sglt | nothing
           |     sgst | nothing
           |     sets | nothing
           |     nplg | nothing
           |     cplg | nothing
           |       tn | nothing
           |       te | nothing
           |     fees | nothing
           |      ret | ArithmeticReturn
           |          |   ucs | nothing
           |          |    lb | nothing
           |      sce | SumScalariser: SumScalariser()
           |     ccnt | nothing
           |     cobj | nothing
           |       sc | Int64: 1
           |       so | Int64: 1
           |     card | nothing
           |    scard | nothing
           |      nea | nothing
           |       l1 | nothing
           |       l2 | nothing
           |       ss | nothing
           |   strict | Bool: false
         r | Variance
           |   settings | RiskMeasureSettings
           |            |   scale | Float64: 1.0
           |            |      ub | nothing
           |            |     rke | Bool: true
           |      sigma | nothing
           |         rc | nothing
           |        alg | SOCRiskExpr()
       obj | MinimumRisk()
        wi | nothing
  fallback | nothing
</code></pre><h3 id="2.3-Performing-the-optimisation"><a class="docs-heading-anchor" href="#2.3-Performing-the-optimisation">2.3 Performing the optimisation</a><a id="2.3-Performing-the-optimisation-1"></a><a class="docs-heading-anchor-permalink" href="#2.3-Performing-the-optimisation" title="Permalink"></a></h3><p>The <code>optimise!</code> function is used to perform all optimisations in <code>PortfolioOptimisers</code>. Each method returns an <code>AbstractResult</code> object containing the optimisation results, which include a return code, a solution object, and relevant statistics (precomputed or otherwise) used in the optimisation.</p><p>The field <code>retcode</code> informs us that our optimisation was successful because it contains an <code>OptimisationSuccess</code> return code.</p><pre><code class="language-julia hljs">res = optimise!(mr, rd)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">JuMPOptimisation
       oe | DataType: MeanRisk
       pa | ProcessedJuMPOptimiserAttributes
          |       pr | LowOrderPrior
          |          |         X | 252×20 Matrix{Float64}
          |          |        mu | 20-element Vector{Float64}
          |          |     sigma | 20×20 Matrix{Float64}
          |          |      chol | nothing
          |          |         w | nothing
          |          |       ens | nothing
          |          |       kld | nothing
          |          |        ow | nothing
          |          |        rr | nothing
          |          |      f_mu | nothing
          |          |   f_sigma | nothing
          |          |       f_w | nothing
          |       wb | WeightBounds
          |          |   lb | 20-element StepRangeLen{Float64, Base.TwicePrecision{Float64}, Base.TwicePrecision{Float64}, Int64}
          |          |   ub | 20-element StepRangeLen{Float64, Base.TwicePrecision{Float64}, Base.TwicePrecision{Float64}, Int64}
          |       lt | nothing
          |       st | nothing
          |      lcs | nothing
          |     cent | nothing
          |    gcard | nothing
          |   sgcard | nothing
          |     smtx | nothing
          |    sgmtx | nothing
          |      slt | nothing
          |      sst | nothing
          |     sglt | nothing
          |     sgst | nothing
          |     nplg | nothing
          |     cplg | nothing
          |       tn | nothing
          |     fees | nothing
          |      ret | ArithmeticReturn
          |          |   ucs | nothing
          |          |    lb | nothing
  retcode | OptimisationSuccess
          |   res | Dict{Any, Any}: Dict{Any, Any}()
      sol | PortfolioOptimisers.JuMPOptimisationSolution
          |   w | 20-element Vector{Float64}
    model | A JuMP Model
          | ├ solver: Clarabel
          | ├ objective_sense: MIN_SENSE
          | │ └ objective_function_type: JuMP.QuadExpr
          | ├ num_variables: 21
          | ├ num_constraints: 4
          | │ ├ JuMP.AffExpr in MOI.EqualTo{Float64}: 1
          | │ ├ Vector{JuMP.AffExpr} in MOI.Nonnegatives: 1
          | │ ├ Vector{JuMP.AffExpr} in MOI.Nonpositives: 1
          | │ └ Vector{JuMP.AffExpr} in MOI.SecondOrderCone: 1
          | └ Names registered in the model
          |   └ :G, :bgt, :dev_1, :dev_1_soc, :k, :lw, :obj_expr, :ret, :risk, :risk_vec, :sc, :so, :variance_flag, :variance_risk_1, :w, :w_lb, :w_ub
</code></pre><p>Lets view the solution results as a pretty table. For convenience, we have ensured all <code>AbstractResult</code> have a property called <code>w</code>, which directly accesses <code>sol.w</code>. The optimisations don&#39;t shuffle the asset order, so we can simply view the asset names and weights side by side.</p><pre><code class="language-julia hljs">pretty_table(DataFrame(:assets =&gt; rd.nx, :weights =&gt; res.w); formatters = resfmt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────┬──────────┐
│ assets │  weights │
│ String │  Float64 │
├────────┼──────────┤
│   AAPL │    0.0 % │
│    AMD │    0.0 % │
│    BAC │    0.0 % │
│    BBY │    0.0 % │
│    CVX │  7.432 % │
│     GE │  0.806 % │
│     HD │    0.0 % │
│    JNJ │ 36.974 % │
│    JPM │  0.749 % │
│     KO │ 11.161 % │
│    LLY │    0.0 % │
│    MRK │ 17.467 % │
│   MSFT │    0.0 % │
│    PEP │  8.978 % │
│    PFE │    0.0 % │
│     PG │  2.353 % │
│    RRC │    0.0 % │
│    UNH │    0.0 % │
│    WMT │  9.355 % │
│    XOM │  4.725 % │
└────────┴──────────┘</code></pre><h2 id="3.-Finite-allocation"><a class="docs-heading-anchor" href="#3.-Finite-allocation">3. Finite allocation</a><a id="3.-Finite-allocation-1"></a><a class="docs-heading-anchor-permalink" href="#3.-Finite-allocation" title="Permalink"></a></h2><p>We have the optimal solution, but most people don&#39;t have access to effectively unlimited funds. Given the optimised weights, current prices and a finite cash amount, it is possible to perform a finite allocation. We will use a discrete allocation method which uses mixed-integer programming to find the best allocation. We have another finite allocation method which uses a greedy algorithm that can deal with fractional shares, but we will reserve it for a later example.</p><p>For the discrete allocation, we need a solver capable of handling mixed-integer programming problems, we will use <code>HiGHS</code>.</p><pre><code class="language-julia hljs">using HiGHS

mip_slv = Solver(; name = :highs1, solver = HiGHS.Optimizer,
                 settings = Dict(&quot;log_to_console&quot; =&gt; false),
                 check_sol = (; allow_local = true, allow_almost = true))
da = DiscreteAllocation(; slv = mip_slv)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DiscreteAllocation
       slv | Solver
           |          name | Symbol: :highs1
           |        solver | DataType: HiGHS.Optimizer
           |      settings | Dict{String, Bool}: Dict{String, Bool}(&quot;log_to_console&quot; =&gt; 0)
           |     check_sol | @NamedTuple{allow_local::Bool, allow_almost::Bool}: (allow_local = true, allow_almost = true)
           |   add_bridges | Bool: true
        sc | Int64: 1
        so | Int64: 1
  fallback | GreedyAllocation
           |     unit | Int64: 1
           |     args | Tuple{}: ()
           |   kwargs | @NamedTuple{}: NamedTuple()
</code></pre><p>Luckily, we have the optimal weights, the latest prices are the last entry of our original time array <code>X</code>, and lets say we have <code>4206.9</code> USD to invest.</p><p>The function can optionally take extra positional arguments to account for a variety of fees, but we will not use them here.</p><pre><code class="language-julia hljs">mip_res = optimise!(da, res.w, vec(values(X[end])), 4206.9)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DiscreteAllocationOptimisation
         oe | DataType: DiscreteAllocation
     shares | 20-element SubArray{Float64, 1, Matrix{Float64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}
       cost | 20-element SubArray{Float64, 1, Matrix{Float64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}
          w | 20-element SubArray{Float64, 1, Matrix{Float64}, Tuple{Base.Slice{Base.OneTo{Int64}}, Int64}, true}
    retcode | OptimisationSuccess
            |   res | nothing
  s_retcode | nothing
  l_retcode | OptimisationSuccess
            |   res | Dict{Any, Any}: Dict{Any, Any}()
    s_model | nothing
    l_model | A JuMP Model
            | ├ solver: HiGHS
            | ├ objective_sense: MIN_SENSE
            | │ └ objective_function_type: JuMP.AffExpr
            | ├ num_variables: 21
            | ├ num_constraints: 42
            | │ ├ JuMP.AffExpr in MOI.GreaterThan{Float64}: 1
            | │ ├ Vector{JuMP.AffExpr} in MOI.NormOneCone: 1
            | │ ├ JuMP.VariableRef in MOI.GreaterThan{Float64}: 20
            | │ └ JuMP.VariableRef in MOI.Integer: 20
            | └ Names registered in the model
            |   └ :eta, :r, :u, :x
       cash | Float64: 8.47199999999711
</code></pre><p>The result of this optimisation contains different pieces of information to the previous one. The reason various fields are prefixed by <code>l_</code>or <code>s_</code> is because the discrete allocation method splits the assets into long and short positions, which are recombined in the final result.</p><p>Lets see the results in another pretty table.</p><pre><code class="language-julia hljs">pretty_table(DataFrame(:assets =&gt; rd.nx, :shares =&gt; mip_res.shares, :cost =&gt; mip_res.cost,
                       :opt_weights =&gt; res.w, :mip_weights =&gt; mip_res.w);
             formatters = mipresfmt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌────────┬─────────┬─────────┬─────────────┬─────────────┐
│ assets │  shares │    cost │ opt_weights │ mip_weights │
│ String │ Float64 │ Float64 │     Float64 │     Float64 │
├────────┼─────────┼─────────┼─────────────┼─────────────┤
│   AAPL │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    AMD │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    BAC │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    BBY │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    CVX │     2.0 │ 347.456 │     7.432 % │     8.276 % │
│     GE │     0.0 │     0.0 │     0.806 % │       0.0 % │
│     HD │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    JNJ │     9.0 │ 1566.77 │    36.974 % │    37.318 % │
│    JPM │     0.0 │     0.0 │     0.749 % │       0.0 % │
│     KO │     6.0 │ 375.654 │    11.161 % │     8.947 % │
│    LLY │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    MRK │     7.0 │ 767.067 │    17.467 % │     18.27 % │
│   MSFT │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    PEP │     2.0 │ 358.556 │     8.978 % │      8.54 % │
│    PFE │     0.0 │     0.0 │       0.0 % │       0.0 % │
│     PG │     1.0 │ 149.133 │     2.353 % │     3.552 % │
│    RRC │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    UNH │     0.0 │     0.0 │       0.0 % │       0.0 % │
│    WMT │     3.0 │ 420.543 │     9.355 % │    10.017 % │
│    XOM │     2.0 │ 213.254 │     4.725 % │     5.079 % │
└────────┴─────────┴─────────┴─────────────┴─────────────┘</code></pre><p>We can see that the mip weights do not exactly match the optimal ones, but that is because we only have finite resources. Note that the sum of the costs minus the initial cash is equal to the <code>cash</code> property of the result. This changes when we introduce fees, which will be shown in a future example.</p><pre><code class="language-julia hljs">println(&quot;used cash ≈ available cash: $(isapprox(mip_res.cash, 4206.9 - sum(mip_res.cost)))&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">used cash ≈ available cash: true</code></pre><p>We can also see that the cost of each asset is equal to the number of shares times its price.</p><pre><code class="language-julia hljs">println(&quot;cost of shares ≈ cost of portfolio: $(all(isapprox.(mip_res.shares .* vec(values(X[end])), mip_res.cost)))&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">cost of shares ≈ cost of portfolio: true</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« PortfolioOptimisers</a><a class="docs-footer-nextpage" href="../2-Mean-Risk-Objectives/">Example 2: <code>MeanRisk</code> objectives »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Saturday 6 September 2025 08:14">Saturday 6 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
